#!usr/bin/python
#Mondragon Mejia Alan Dennis 
#Enumeracion de usuarios  SMTP Se recomienda usar metasploitable2 para verificar el funcionamiento 

import socket
import sys
if len(sys.argv) != 2:
        sys.exit("python enumeracion.py ip")
ip= sys.argv[1]
cmd = 'vrfy'
usuarios=raw_input("Ingresa un usuario para validar validar: ")
try:
	conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	conn.connect((ip,25))
	banner = conn.recv(1024) ## regresa los baner 
	print banner

	if '220' in banner:
		conn.send(cmnd+' '+user+'\n')
		result = conn.recv(1024)
		print result
		if '252' in result:
			print ' EL Usuario es valido: ' + user
		else:
			print 'El Usuario es invalido: ' + user 
	conn.close()
except socket.timeout:
	print 'timeout: '+ip
except socket.error:
	print 'timeout: '+ip
