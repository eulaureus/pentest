#!/usr/bin/lua
-- apt-get install luarocks 
-- apt-get install lua-socket


-- load the http module
local io = require("io")
local http = require("socket.http")
local ltn12 = require("ltn12")

-- connect to server "www.altoromutual.com" and retrieves this manual
-- file from "~bank/login.aspx" and print it to stdout
http.request{ 
    url = "http://www.altoromutual.com/bank/login.aspx", 
    sink = ltn12.sink.file(io.stdout)
}

-- connect to server "www.altoromutual.com" and tries to retrieve
-- "/bank/login.aspx". Fails because authentication is needed.
b, c, h = http.request("")
-- b returns some useless page telling about the denied access, 
-- h returns authentication information
-- and c returns with value 401 (Authentication Required)

-- tries to connect to server "http://www.altoromutual.com/bank/login.aspx" to retrieve "/"
-- and fails because the host does not exist.
r, e = http.request("http://www.altoromutual.com/bank/login.aspx")
-- r is nil, and e returns with value "host not found"


-- Alternatively, one could fill the appropriate header and authenticate
-- the request directly.
r, c = http.request {
  url = "http://www.altoromutual.com/bank/login.aspx",
  headers = { authentication = "Basic " .. (mime.b64("' OR 1=1 --:*")) }

}
